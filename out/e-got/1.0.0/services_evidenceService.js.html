<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: services/evidenceService.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: services/evidenceService.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * This module realize logic connected with evidence data abstraction
 * @module Evidence-Service**/
const mongo = require('../mongoDB.js')
const ObjectId = require('mongodb').ObjectID

class EvidenceService {
  /**@function addEvidence**/
  async addEvidence(req, res) {
    console.log("-> new evidence")
    const payload = req.body
    const trackId = await getTrackId(payload)
    const evidence = {
      track: trackId,
      author: "build_in_turist",
      photo: payload.photo,
      startPoint: payload.startPoint,
      endPoint: payload.endPoint,
      approved: null,
      trackDate: payload.trackDate,
      additionDate: Date()
    }
    const result = await mongo.evidences.insertOne(evidence)
    if (result.insertedCount === 1) {
      res.status(201).send()
    } else {
      res.status(409).send()
    }
  }

  /**@function changeStatus**/
  async changeStatus(req) {
    console.log("-> evidence status change")
    const _id = ObjectId(req.params.id)
    const approved = req.body.approved
    return mongo.evidences.findOneAndUpdate({_id}, {$set: {approved}})
  }

  /**@function remove**/
  remove(req) {
    console.log("-> remove evidence")
    const _id = ObjectId(req.params.id)
    return mongo.evidences.findOneAndDelete({_id})
  }

  /**@function verificatorEvidences**/
  async verificatorEvidences() {
    console.log("-> verificator evidences")
    return (await mongo.evidences
      .find({approved: null}).toArray())
      .map(y => {
        y.photo = null;
        return y
      }) //TODO: fix projection

  }

  /**@function turistEvidences**/
  turistEvidences() {
    console.log("-> turist evidence")
    return mongo.evidences.find({}).toArray()
  }

  /**@function getOne**/
  getOne(req, res) {
    console.log("-> get one evidence")
    const _id = ObjectId(req.params.id)
    return mongo.evidences.findOne({_id})
  }
}

module.exports = new EvidenceService()

async function getTrackId(payload) {
  return await {_id: 32424}
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Evidence-Service.html">Evidence-Service</a></li><li><a href="module-Main.html">Main</a></li><li><a href="module-MongoService.html">MongoService</a></li><li><a href="module-REST-API.html">REST-API</a></li><li><a href="module-Routes-Service.html">Routes-Service</a></li><li><a href="module-Track-Service.html">Track-Service</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Mon Jan 28 2019 10:24:40 GMT+0100 (CET)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
